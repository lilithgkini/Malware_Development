#importing modules
import re #this will allow us to use regex
import sys 
import uuid

def file_read(path):
    try:
        with open(path, "r") as file: content = file.read()
        print("File Contents: ")
        print(content)
        file.close()
        return content
    except FileNotFoundError:
        print("Error: could not find a file in this path: " + path)
    except Exeption as e:
        print("Error: "+e)
    

used_vars = []
if(len(sys.argv)<2):
    print("Use: "+ sys.argv[0] +" path/to/file")
    sys.exit()

print("Opening the file..")

payload = file_read(sys.argv[1])
variables = re.findall('\$\w+\s*=', payload)
#now we want to rename these variables using uuid4

for var in variables:
    
    #first we sanitize it by removing new lines, tabs, spaces and the equal sign
    var = re.sub("[\t\n\s=]*","",var)
    # now we need to make sure we don't get duplicate
    new_var = uuid.uuid4().hex
    
    if (new_var in used_vars)or (new_var in payload):
        while new_var in used_vars:
            new_var = var.uuid4()
    used_vars.append(new_var)

    # replace the payload with the new variables
    payload = payload.replace(var, "$"+new_var)

print(payload)