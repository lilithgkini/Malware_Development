# Powershell Obfuscation
An automated tool that can obfuscate powershell code is [Invoke-Obfuscation](https://github.com/danielbohannon/Invoke-Obfuscation) 
It can obfuscate powershell one-liners or even powershell scripts suck as mimikatz.ps1.

In order to properly obfuscate a known malicious script such as mimikatz we need to make few edits to the code ourselves.
Because we can't use words like mimikatz in the shell, windows defender will flag it immediately even if it's not malicious, we either have to rename the Invoke-Mimikatz function alongside many of the options like sekurlsa, Or we can use the obfuscatory to obfuscate the command we will provide in powershell to invoke and use mimikatz, avoiding the signature based detection of Windows Defender.

Another way of obfuscating powershell commands, or scripts is to make a python script that would find all the variables in the code (they always start with $ and end with equal sign = ) and replace them with randomly generated variables.

We can either define a randomize function, or use the uuid function as seen [here](https://stackoverflow.com/questions/2030053/how-to-generate-random-strings-in-python)

For example if we use this script on the classic powershell oneliner and also replace the part "(pwd).Path" with "$(gl)" which is short for [Get-Location](https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-location?view=powershell-7.4) and then encode it in base64 so it escapes the bad characters with a powershell command like this
```powershell
[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes([IO.File]::ReadAllText("path\to\your\payload")))
```
And then use 
```powershell
powershell.exe -e <base64_code>
```
It will give us a reverse shell and bypass the signature based detection of some antiviruses, including Windows Defender
